<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.dongnae.map.dao.MapDAO">
	
 	<select id="getMapList" parameterType="mapVO" resultType="mapVO">
		SELECT * FROM MAP
		WHERE DEL_YN = 0
		<if test="${userEmail} != null">
		AND USER_EMAIL = ${userEmail}
		</if>
		<if test="${limitRole} != null">
		AND LIMIT_ROLE = ${limitRole}
		</if>
	</select>
	
 	<select id="getMap" parameterType="mapVO" resultType="mapVO">
		SELECT * FROM MAP
		WHERE DEL_YN = 0
		AND MAP_IDX = ${maPIdx}
	</select>
	
<!-- 	<insert id="insertMap" parameterType="mapVO"> -->
<!-- 		INSERT INTO MAP (MAP_IDX, USER_EMAIL, TITLE, CONTENT, -->
<!-- 			VIEW_LEVEL, CENTER_LATITUDE, CENTER_LOGITUDE, CREATE_DATE, OPEN_YN, DEL_YN) -->
<!-- 		VALUES (SEQ_MAP_IDX.NEXTVAL, #{userEmail}, #{title}, #{content}, -->
<!-- 			#{viewLevel}, #{centerLatitude}, #{centerLogitude}, SYSDATE, 0, 0) -->
<!-- 	</insert> -->
	
		<!-- 맵 삽입 -->
	<insert id="insertMap" parameterType="mapVO">
	    <!-- 시퀀스를 사용하여 mapIdx 설정 -->
	    <selectKey keyProperty="mapIdx" resultType="int" order="BEFORE">
	        SELECT SEQ_MAP_IDX.NEXTVAL AS mapIdx FROM DUAL
	    </selectKey>
	    
	    <!-- 맵 삽입 -->
	    INSERT INTO MAP (MAP_IDX, USER_EMAIL, TITLE, CONTENT,
	        VIEW_LEVEL, CENTER_LATITUDE, CENTER_LONGITUDE, CREATE_DATE, OPEN_YN, DEL_YN)
	    VALUES (#{mapIdx}, #{userEmail}, #{title}, #{content},
	        #{viewLevel}, #{centerLatitude}, #{centerLongitude}, SYSTIMESTAMP, 0, 0)
	</insert>
	
	
	<update id="updateMap" parameterType="mapVO">
		UPDATE MAKER
		SET 
		<if test="#{title} != null">
			TITLE= #{title}
		</if>
		<if test="#{content} != null">
			CONTENT = #{content}
		</if>
		<if test="#{centerLatitude} != null">
			CENTER_LATITUDE = #{centerLatitude}
		</if>
		<if test="#{centerLogitude} != null">
			CENTER_LOGITUDE = #{centerLogitude}
		</if>
		WHERE DEL_YN = 0
		AND MAP_IDX = ${mapIdx}
	</update>
	
	<update id="deleteMap" parameterType="mapVO">
		UPDATE MAP
		SET DEL_YN = 1
		WHERE DEL_YN = 0
		AND MAP_IDX = ${mapIdx}
	</update>
	
</mapper>





