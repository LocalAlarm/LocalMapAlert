<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.spring.dongnae.user.dao.UserCacheDAO">

    <!-- 토큰으로 유저 정보 조회 -->
    <select id="getUserByTokenFromDatabase" resultType="com.spring.dongnae.user.dto.UserCacheDTO">
        SELECT TOKEN, EMAIL, IMAGE, NICKNAME FROM USERS WHERE token = #{token}
    </select>
    
    <!-- 이메일로 유저 정보 조회 -->
    <select id="getUserByEmailFromDatabase" resultType="com.spring.dongnae.user.dto.UserCacheDTO">
        SELECT token, email, image, nickname FROM users WHERE email = #{email}
    </select>
    
	
	<!-- 이메일로 유저 리스트 조회 -->
    <select id="searchUsersByEmail" resultType="com.spring.dongnae.user.dto.UserCacheDTO">
        <![CDATA[
        SELECT email, image, nickname, token
        FROM (
            SELECT *
            FROM users
            WHERE email LIKE '%' || #{email} || '%'
            ORDER BY email
        )
        WHERE ROWNUM <= 5
        ]]>
    </select>
    
    <!-- 모든 유저 조회 -->
    <select id="findAllUsers" resultType="com.spring.dongnae.user.dto.UserCacheDTO">
        SELECT token, email, image, nickname 
        FROM users
    </select>
	
</mapper>
